{% from "partials/legacy-predictor-timeline-item/macro.njk" import predictorTimelineItem %}

{% set allSectionIds %}
  {%- for item in predictorScores -%}
    predictor-section-{{ item.date | replace(" ", "-") | replace(":", "-") | lower }}{{ " " if not loop.last }}
  {%- endfor -%}
{% endset %}

<div class="govuk-body predictor-timeline__heading">
  <h2 class="govuk-heading-l">Scores history</h2>
  <a id="predictor-timeline__toggle-all" href="#" class="govuk-link" aria-label="Open all score history"
     aria-controls="{{ allSectionIds }}" aria-expanded="false">Open all</a>
</div>

<div class="moj-timeline predictor">
  {% for item in predictorScores %}

    {% set sectionId = "predictor-section-" + (item.date | replace(" ", "-") | replace(":", "-") | lower) %}

    <div class="moj-timeline__item">
      <div class="moj-timeline__header">
        <p class="moj-timeline__byline">{{ item.date }}</p>
      </div>
      <div class="moj-timeline__description">
        <div id="{{ sectionId }}" class="predictor-timeline-section">
          <ul class="govuk-list">
            <li>{{ predictorTimelineItem(item.scores.RSR) }}</li>
            {% if item.scores.OSPDC %}
              <li>{{ predictorTimelineItem(item.scores.OSPDC) }}</li>
            {% else %}
              <li>{{ predictorTimelineItem(item.scores.OSPC) }}</li>
            {% endif %}
            {% if item.scores.OSPIIC %}
              <li>{{ predictorTimelineItem(item.scores.OSPIIC) }}</li>
            {% else %}
              <li>{{ predictorTimelineItem(item.scores.OSPI) }}</li>
            {% endif %}
          </ul>
        </div>
        <a href="#" class="govuk-link predictor-timeline__toggle-section" aria-label="View scores for {{ item.date }}"
           aria-controls="{{ sectionId }}" aria-expanded="false">Open</a>
      </div>
    </div>
  {% endfor %}
</div>

<script type="module" src="{{ '/assets/js/predictor-timeline.js' | assetMap }}"></script>
